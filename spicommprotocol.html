

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SPI Communication Protocol &mdash; learn-ml  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Face Detection Data API" href="face.html" />
    <link rel="prev" title="learn_ml.utils package" href="learn_ml.utils.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> learn-ml
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="modules.html">learn_ml</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">SPI Communication Protocol</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#spi-settings">SPI Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wiring">Wiring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#arduino-wiring">Arduino Wiring</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#message-format">Message Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#header">Header</a></li>
<li class="toctree-l3"><a class="reference internal" href="#body">Body</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#initialization-sequence">Initialization sequence</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coral">Coral</a></li>
<li class="toctree-l3"><a class="reference internal" href="#microcontroller">Microcontroller</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#heartbeat">Heartbeat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="face.html">Face Detection Data API</a></li>
<li class="toctree-l1"><a class="reference internal" href="posenet.html">Posenet Data API</a></li>
<li class="toctree-l1"><a class="reference internal" href="arduinoquickstart.html">Arduino Quickstart</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">learn-ml</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>SPI Communication Protocol</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/spicommprotocol.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spi-communication-protocol">
<h1>SPI Communication Protocol<a class="headerlink" href="#spi-communication-protocol" title="Permalink to this headline">¶</a></h1>
<p>This document describes the protocol that the microcontroller and Coral expect to communicate data over SPI. Currently, the devices are configured such that the Coral is the master and the microcontroller is the slave.</p>
<div class="section" id="spi-settings">
<h2>SPI Settings<a class="headerlink" href="#spi-settings" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Max Speed: 10 kHz</p></li>
<li><p>Bits per word: 8</p></li>
<li><p>Bit order: MSB</p></li>
<li><p>SPI Mode: 0</p></li>
</ul>
</div>
<div class="section" id="wiring">
<h2>Wiring<a class="headerlink" href="#wiring" title="Permalink to this headline">¶</a></h2>
<p>This protocol uses the standard 4-wire SPI protocol with an GPIO wire and ground wire. This is a total of 6 wires. The GPIO pin should be configured as an output on the microcontroller and as an input on the Coral.</p>
<div class="section" id="arduino-wiring">
<h3>Arduino Wiring<a class="headerlink" href="#arduino-wiring" title="Permalink to this headline">¶</a></h3>
<p>The Arduino library requires the following wiring:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Arduino Pin</th>
<th align="center">Coral Pin</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">GND</td>
<td align="center">GND</td>
<td align="center">GND (14)</td>
</tr>
<tr>
<td align="center">SCK</td>
<td align="center">13</td>
<td align="center">23</td>
</tr>
<tr>
<td align="center">MISO</td>
<td align="center">12</td>
<td align="center">21</td>
</tr>
<tr>
<td align="center">MOSI</td>
<td align="center">11</td>
<td align="center">19</td>
</tr>
<tr>
<td align="center">SS</td>
<td align="center">10</td>
<td align="center">24</td>
</tr>
<tr>
<td align="center">SIGNAL (GPIO)</td>
<td align="center">9</td>
<td align="center">13</td>
</tr>
</tbody>
</table></div>
</div>
<div class="section" id="message-format">
<h2>Message Format<a class="headerlink" href="#message-format" title="Permalink to this headline">¶</a></h2>
<p>Each message contains 2 parts: the header and the message body.</p>
<div class="section" id="header">
<h3>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h3>
<p>The header is a 1 byte message. It describes what content will be contained in the body. The current valid headers are listed below in the table below.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Header Value</th>
<th align="center">Meaning</th>
<th align="center">Message Body Length</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0x10</td>
<td align="center">Hearbeat</td>
<td align="center">0 bytes</td>
</tr>
<tr>
<td align="center">0x20</td>
<td align="center">Config</td>
<td align="center">4 bytes</td>
</tr>
<tr>
<td align="center">0x30</td>
<td align="center">Data</td>
<td align="center">Data length</td>
</tr>
</tbody>
</table><p>The data length is variable determined by the output size of the neural net. This data length size is specified in a config message and then cannot be changed afterwards.</p>
</div>
<div class="section" id="body">
<h3>Body<a class="headerlink" href="#body" title="Permalink to this headline">¶</a></h3>
<p>The body of the message is a series of bytes of the length determined by the header. The messages are in MSB format.</p>
</div>
</div>
<div class="section" id="initialization-sequence">
<h2>Initialization sequence<a class="headerlink" href="#initialization-sequence" title="Permalink to this headline">¶</a></h2>
<div class="section" id="coral">
<h3>Coral<a class="headerlink" href="#coral" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>While waiting for a connection from the microcontroller, the Coral should be sending 0XFF constantly on the SPI channel. The microcontroller should respond with a series of three bytes: 0xFF, 0xFE, 0xFD (in that sequence).</p></li>
<li><p>Next, a config message must be sent over SPI. First, the config header is transferred, followed by an empty message [0x00,0x00,0x00,0x00] to signal to the microcontroller that the Coral successfully received the heartbeat.</p></li>
<li><p>After that message is transferred, the Coral should wait for a HIGH on the signal pin, signifying the Arduino is ready to receive the config</p></li>
<li><p>Once the high is received, the config message should be sent. Send the config header, followed by the following 4 bytes:</p></li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">Position</th>
<th align="center">Value</th>
<th align="center">Info</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0</td>
<td align="center">Datatype</td>
<td align="center">Currently not implemented</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">Data Length</td>
<td align="center">Length of data in bytes</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Empty</td>
<td align="center">Value can be anything</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">Empty</td>
<td align="center">Value can be anything</td>
</tr>
</tbody>
</table></div>
<div class="section" id="microcontroller">
<h3>Microcontroller<a class="headerlink" href="#microcontroller" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Listen for messages sent via SPI. After received one 0xFF, load 0xFF into buffer to send to the Coral. This value should be decremented every time a transfer occurs, until a total of 4 0xFF messages are received.</p></li>
<li><p>Listen for a config header followed by a message body containing [0x00, 0x00, 0x00, 0x00]. This is an acknowledgement by the Coral that it received the response correctly.</p></li>
<li><p>Once the microcontroller is ready to receive the config information, raise the SIGNAL line high.</p></li>
<li><p>Listen for the config and configure the buffer and message fields correctly. The message format is listed above.</p></li>
</ol>
</div>
</div>
<div class="section" id="heartbeat">
<h2>Heartbeat<a class="headerlink" href="#heartbeat" title="Permalink to this headline">¶</a></h2>
<p>The coral should send a heartbeat at a regular frequency to the microcontroller to check availability. The response from the microcontroller should increment on every message transferred (including non-heartbeat messages), except where there is an overflow (0xFF -&gt; 0x00). If the heartbeat message is no longer incrementing, the microcontroller is unavailable or has been reset. The communications should return to init state.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="face.html" class="btn btn-neutral float-right" title="Face Detection Data API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="learn_ml.utils.html" class="btn btn-neutral float-left" title="learn_ml.utils package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Alexander Barnett, Swapnil Pande, Alexander Stephens

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>